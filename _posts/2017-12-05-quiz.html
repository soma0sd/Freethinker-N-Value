<head>
  <meta charset="utf-8">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
  <link rel="shortcut icon" type="x-icon" href="icon.png">
  <link rel="stylesheet" href= "{{ site.url }}/style.css">

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>{% if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}</title>
</head>
<body class="container">
  <script type="application/javascript"
          src="{{ site.url }}/questions.js">
  </script>
  <h1 class="center-align">Freethink N-Values</h1>
  <hr>
  <h2 style="text-align:center;" id="question-number">Loading...</h2>
  <p class="question" id="question-text"></p>
  <button class="button" onclick="next_question( 1.0)" style="background-color: #1b5e20;">겁나동의</button> <br>
  <button class="button" onclick="next_question( 0.5)" style="background-color: #4caf50;">동의</button> <br>
  <button class="button" onclick="next_question( 0.0)" style="background-color: #bbbbbb;">어..음..</button> <br>
  <button class="button" onclick="next_question(-0.5)" style="background-color: #f44336;">아님</button> <br>
  <button class="button" onclick="next_question(-1.0)" style="background-color: #b71c1c;">겁나아님</button> <br>
  <button class="small_button" onclick="prev_question()" id="back_button">Back</button>
  <button class="small_button_off" id="back_button_off">Back</button><br>
  <!-- 스크립트 로드 -->
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
  <!-- 테스트용 스크립트 -->
  <script>
      var max_econ, max_dipl, max_govt, max_scty; // Max possible scores
      max_econ = max_dipl = max_govt = max_scty = 0;
      var econ, dipl, govt, scty; // User's scores
      econ = dipl = govt = scty = 0;
      var qn = 0; // Question number
      var prev_answer = null;
      init_question();
      for (var i = 0; i < questions.length; i++) {
          max_econ += Math.abs(questions[i].effect.econ)
          max_dipl += Math.abs(questions[i].effect.dipl)
          max_govt += Math.abs(questions[i].effect.govt)
          max_scty += Math.abs(questions[i].effect.scty)
      }
      function init_question() {
          document.getElementById("question-text").innerHTML = questions[qn].question;
          document.getElementById("question-number").innerHTML = "Question " + (qn + 1) + " of " + (questions.length);
          if (prev_answer == null) {
              document.getElementById("back_button").style.display = 'none';
              document.getElementById("back_button_off").style.display = 'block';
          } else {
              document.getElementById("back_button").style.display = 'block';
              document.getElementById("back_button_off").style.display = 'none';
          }

      }

      function next_question(mult) {
          econ += mult*questions[qn].effect.econ
          dipl += mult*questions[qn].effect.dipl
          govt += mult*questions[qn].effect.govt
          scty += mult*questions[qn].effect.scty
          qn++;
          prev_answer = mult;
          if (qn < questions.length) {
              init_question();
          } else {
              results();
          }
      }
      function prev_question() {
          if (prev_answer == null) {
              return;
          }
          qn--;
          econ -= prev_answer * questions[qn].effect.econ;
          dipl -= prev_answer * questions[qn].effect.dipl;
          govt -= prev_answer * questions[qn].effect.govt;
          scty -= prev_answer * questions[qn].effect.scty;
          prev_answer = null;
          init_question();

      }
      function calc_score(score,max) {
          return (100*(max+score)/(2*max)).toFixed(1)
      }
      function results() {
          location.href = `results.html`
              + `?e=${calc_score(econ,max_econ)}`
              + `&d=${calc_score(dipl,max_dipl)}`
              + `&g=${calc_score(govt,max_govt)}`
              + `&s=${calc_score(scty,max_scty)}`
      }
  </script>
</body>
